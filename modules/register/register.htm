
<style type="text/css">
	.login .content button{ vertical-align:top;}
	.login .content input{font-size: 16px !important; vertical-align:middle;}
	.login .banner {width: 100%; }
	.login .content {padding: 0px; width: 100%; }
	.login .light {background:rgba(255, 255, 255, 0.5); }
</style>

<!-- BEGIN REGISTER WRAPPER -->
<div class="login-wrapper login">
  
    <!-- BEGIN LOGIN -->
    <div class="content" >
        <div class="portlet  light login-content">
                        <div class="portlet-title tabbable-line">
                            
                            <ul class="nav nav-tabs">
                                
                                <li class="active">
                                    <a href="#tab4" data-toggle="tab" class="t4 bold">@t[Sign]</a>
                                </li>
                                <li>
                                    <a href="$_webroot/login" class="t4 bold ">@t[Login] </a >
                                </li>
                            </ul>
                            
                        </div>

                        <div class="portlet-body ">
                            
                            <div class="tab-content margin-top-20 margin-bottom-30">
                                    

                                   <div class="tab-pane active in" id="tab4">

                                        <form class="register-form3" action="$_base/register" method="post">
                                            <input type="hidden" name="pkey" value="$__aeskey" id="param_pkey" />
                                            <input type="hidden" name="sbt" value="$sbt" />

                                            <div class="alert alert-danger display-hide">
                                                <button class="close" data-close="alert"></button>
                                                <span> Enter any username and password. </span>
                                            </div>
                                            <div class="form-group">
                                                <div class="input-icon">
                                                    <i class="fa fa-user"></i>
                                                    <input class="form-control placeholder-no-fix" type="text" autocomplete="off" placeholder="@t[Username]" name="params[name]" /> </div>
                                            </div>

                                            <div class="form-group">
                                                <div class="input-icon">
                                                    <i class="fa fa-lock"></i>
                                                    <input class="form-control placeholder-no-fix" type="password" autocomplete="off" placeholder="@t[Password]" name="params[password]" id="param_password" /> </div>
                                            </div>

                                            <div class="form-group">
                                                <div class="input-icon">
                                                    <i class="fa fa-lock"></i>
                                                    <input class="form-control placeholder-no-fix" type="password" autocomplete="off" placeholder="@t[Retry Password]" name="params[password2]" id="param_password2" /> </div>
                                            </div>



                                            <div class="form-group">
                                                <div class="input-icon">
                                                    <i class="fa fa-commenting-o"></i>
                                                    <input class="form-control placeholder-no-fix" type="text" autocomplete="off" placeholder="@t[Mobile/Email]" name="params[account]" value="$params[account]" id="param_account"  /> </div>
                                            </div>
                                            <div class="form-group">

                                                <div class="input-icon" style="display: inline-block;">
                                                    <i class="fa fa-key"></i>
                                                    <input class="form-control placeholder-no-fix input-small" type="text" autocomplete="off" placeholder="@t[Security Code]" name="params[seccode]" /> 
                                                </div>

                                                <button class="btn btn-default fix-btn" type="button" id="btnGetSecurityCode2"> @t[Get Security Code] </button>

                                                <div class="clearfix"></div>
                                            </div>

                                                                                            
                                            <div class="form-actions">
                                                <button type="submit" class="btn btn-primary form-control">@t[Sign]</button>
                                            </div>
                                            
                                        </form>                                            
                                    </div>


                            </div>
                        </div>
        </div>
    </div>
    <!-- END LOGIN -->
</div>
<!-- END REGISTER WRAPPER -->

<script language="javascript">

jQuery(document).ready(function() {	


   //验证码登录
   var timeout = parseInt("$seccodetimeout");       
   function waitingGetSecurityCode()
   {    //倒计时
        var el = $('#btnGetSecurityCode');
        if (timeout -- > 0) {
            el.prop('disabled', true);
            el.html(timeout+'秒后超时');
            
            setTimeout(waitingGetSecurityCode, 1000);
        } else {
             el.prop('disabled', false);
             el.html("@t[Retry Get Security Code]");
             timeout = parseInt("$seccodetimeout");
        }
   }
   
   $('#btnGetSecurityCode').on('click', function(e) {
        var account = $('#param_account').val();
        if (account == '')
            return false;
        
        $.post('$_base/sendSecurityCode', {'account':account}, function(res) {
            if (res.status == 0) {
                rui.showTSuccess('操作成功.'); 
                waitingGetSecurityCode();                                       
            } else {
               rui.showTError('操作失败:'+res.status);
            }
        }).error(function(){
              rui.showTError('系统错误！');      
        });
   });

	var handleRegister = function () {

         $('.register-form3').validate({
	            errorElement: 'span', //default input error message container
	            errorClass: 'help-block', // default input error message class
	            focusInvalid: false, // do not focus the last invalid input
	            ignore: "",
	            rules: {
	                
	                'params[name]': {
	                    required: true
	                },
	                'params[password]': {
	                    required: true
	                },
	                'params[password2]': {
	                    equalTo: "#param_password"
	                },

	                'params[account]': {
                      required: true,
	                },
                    'params[seccode]': {
                        required: true
                    },
                    tnc: {
                        required: true
                    }
	            },

	            messages: { // custom messages for radio buttons and checkboxes
                    'params[name]': {
                        required: t("The field is required."),
                    },
                    'params[password]': {
                        required: t("The field is required."),
                    },
                    'params[password2]': {
                        required: t("The field is required."),
                    },
                    'params[account]': {
                        required: t("The field is required."),
                    },
                    'params[seccode]': {
                        required: t("The field is required."),
                    },
                    
	                tnc: {
	                    required: "Please accept TNC first."
	                }
	            },

	            invalidHandler: function (event, validator) { //display error alert on form submit   

	            },

	            highlight: function (element) { // hightlight error inputs
	                $(element)
	                    .closest('.form-group').addClass('has-error'); // set error class to the control group
	            },

	            success: function (label) {
	                label.closest('.form-group').removeClass('has-error');
	                label.remove();
	            },

	            errorPlacement: function (error, element) {
	                if (element.attr("name") == "tnc") { // insert checkbox errors after the container                  
	                    error.insertAfter($('#register_tnc_error'));
	                } else if (element.closest('.input-icon').size() === 1) {
	                    error.insertAfter(element.closest('.input-icon'));
	                } else {
	                	error.insertAfter(element);
	                }
	            },

	            submitHandler: function (form) {
	               showWaiting("请稍后。。。");                              
                   var  formData = $(form).serializeArray();
                   var pkey = $('#param_pkey').val();
                   //加密
                   for (i=0; i<formData.length; i++) {
                        if (formData[i].name == "params[password]" || formData[i].name == "params[password2]") {
                            var val = formData[i].value;
                            var _val = encrypt(val, pkey);
                            formData[i].value = _val;
                        }
                   }                          

                   //console.log(formData);                       
                   $.post(form.action, formData, function(res) {
                        if (res.status == 0) {
                            rui.showTSuccess('操作成功.');
                            rui.redirect("$_basename", 1);    
                        } else {
                            var msg = '操作失败:'+res.status;
                            if (res.msg)
                                msg = res.msg;
                            rui.showTError(msg);
                        }
                    }).error(function(){
                          rui.showTError('系统错误！');      
                    }); 
                    closeWaiting();
	            }
	        });

			$('.register-form3 input').keypress(function (e) {
	            if (e.which == 13) {
	                if ($('.register-form3').validate().form()) {
	                    $('.register-form3').submit();
	                }
	                return false;
	            }
	        });


            //验证码

           var timeout2 = parseInt("$seccodetimeout");       
           function waitingGetSecurityCode2()
           {    //倒计时
                var el = $('#btnGetSecurityCode2');
                if (timeout2 -- > 0) {
                    el.prop('disabled', true);
                    el.html(timeout+'秒后超时');
                    
                    setTimeout(waitingGetSecurityCode2, 1000);
                } else {
                     el.prop('disabled', false);
                     el.html("@t[Retry Get Security Code]");
                     timeout2 = parseInt("$seccodetimeout");
                }
           }
           
           $('#btnGetSecurityCode2').on('click', function(e) {
                var account = $('#param_account').val();
                if (account == '')
                    return false;
                
                $.post('$_base/sendSecurityCode', {'account':account}, function(res) {
                    if (res.status == 0) {
                        rui.showTSuccess('操作成功.'); 
                        waitingGetSecurityCode2();                                       
                    } else {
                       rui.showTError('操作失败:'+res.status);
                    }
                }).error(function(){
                      rui.showTError('系统错误！');      
                });
           });

	}

            if (!_.isUndefined(G._i18ndb)) {
        	    I18N.register(G._i18ndb); 
        	} 
        	
        	if (typeof G_i18ndb != "undefined") {
        		I18N.register(G_i18ndb); 
        	}
        	
        	handleRegister(); 
           
           var bgdb = G._bgdb;

           var bgdir = G._dstroot+'/img/bg/';
           var defaultbg = [
						bgdir + '1.jpg',  
						bgdir + '2.jpg', 
						bgdir + '3.jpg'];
				
           if (!_.isArray(bgdb) || bgdb.length == 0)
                bgdb = defaultbg;
            // init background slide images
            $.backstretch(bgdb, {
			      fade: 1000,
			      duration: 8000
					});
});


</script>    